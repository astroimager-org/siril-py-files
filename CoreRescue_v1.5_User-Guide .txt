# ðŸ— User Guide: CoreRescue v1.5.4

### Specialized HDR Nebula Sculptor

**How it Works**
This tool is a specialized High Dynamic Range (HDR) blender. It allows you to perform two simultaneous stretches on a single linear FITS file: one gentle, color-safe stretch to preserve bright core details (like the Trapezium in M42) and one aggressive stretch to reveal faint outer nebulosity. It then uses a Luminosity Mask to seamlessly blend them together.

---

### 1. Requirements & Dependencies

CoreRescue requires a "bridge" between the UI and Siril's processing engine:

1. **Python 3.x & Pip:** (Included with Siril's internal environment).
2. **pysiril:** The engine that sends HDR PixelMath commands to Siril.
3. **Pillow (PIL):** The engine that renders your HDR previews on screen.

**Note on Python Libraries:** CoreRescue utilizes *pysiril* to maintain a "direct-line" connection with Siril. This ensures that as you adjust sliders, the blend updates in near real-time without the overhead of standard scripts.

---

### 2. Installation Steps (Host PC)

The script features an **Automated Magic Installer**. On first launch, it will attempt to download and inject the libraries for you. If the console reports an error, use the manual steps below.

**Manual Failsafe (PowerShell Admin)**
*Replace "Tony" with your Windows username.*

1. **Create the fix folder:**
`New-Item -ItemType Directory -Force -Path "C:\siril_fix"`
2. **Download pysiril:**
`Invoke-WebRequest -Uri "https://gitlab.com/-/project/20510105/uploads/8224707c29669f255ad43da3b93bc5ec/pysiril-0.0.15-py3-none-any.whl" -OutFile "C:\siril_fix\pysiril-0.0.15-py3-none-any.whl"`
3. **Download Pillow:**
`Invoke-WebRequest -Uri "https://files.pythonhosted.org/packages/08/5c/2104299949b9d504baf3f4d35f73dbd14ef31bbd1ddc2c1b66a5b7dfda44/pillow-11.1.0-cp312-cp312-win_amd64.whl" -OutFile "C:\siril_fix\pillow-11.1.0-cp312-cp312-win_amd64.whl"`
4. **Inject into Siril:**
`C:\Users\Tony\AppData\Local\siril\venv\Scripts\python.exe -m pip install "C:\siril_fix\pysiril-0.0.15-py3-none-any.whl" "C:\siril_fix\pillow-11.1.0-cp312-cp312-win_amd64.whl"`

---

### 3. Placing & Launching

* **Path:** `C:\Users\Tony\AppData\Roaming\siril\scripts\`
* **To Launch:** Inside Siril, go to **Scripts âž” Python Scripts âž” CoreRescue**.
* **Tip:** If you just added the file, remember to hit **Scripts âž” Refresh Scripts** in Siril.

---

### ðŸ•’ When to Use This Script

This script **must** be used on **Linear (Unstretched) data**.

1. **Pre-processing:** Perform Stacking, Background Extraction, and Color Calibration (SPCC) in Siril.
2. **CoreRescue:** Load your calibrated Linear FITS.
3. **Final Polish:** Save as `HDR_Rescued.fits` and return to Siril/Photoshop for final curves and sharpening.

---

### âš™ï¸ Detailed Settings Guide

**1. Core Stretch (-) >> Brighter**

* **Logic:** Uses **asinh (Inverse Hyperbolic Sine)**.
* **Why:** `asinh` is color-safe. It brightens pixels without washing them out to white.
* **Goal:** Keep this low enough that you can still see the individual stars in the Trapezium (M42) rather than a white blob.

**2. Core Saturation (-) >> More**

* **Purpose:** Targets only the bright center protected by your mask.
* **Tip:** If the HDR blend makes the center look "pasty" or greyish, push this to 1.5 or 2.0 to make stars pop.

**3. Background BP (-) >> Darker**

* **Purpose:** Sets the floor for the shadows (Black Point).
* **Tip:** If the dark areas look "milky" after stretching the nebula, nudge this up to restore true black.

**4. Nebula Stretch Brighter << (-)**

* **Logic:** Uses **MTF (Midtone Transformation)**.
* **Why:** This is the "heavy lifter" for faint data. It digs into the noise floor to pull out dust.
* **Tip:** Moving the slider **Left** pulls more light out. Don't worry if the core looks white here; the script will "rescue" it.

**5. Blend Feathering (-) >> Softer**

* **Purpose:** Controls the **Gaussian Blur** of the luminosity mask.
* **Tip:** If you see a visible "ring" or "seam" between the core and the nebula, increase this to soften the transition.

---

### ðŸ“– Navigation & Inspection

**View Inspector Modes:**

* **Blend (Default):** The final HDR result.
* **Core Only:** Use this to ensure the stars in the Trapezium are sharp and colorful.
* **Nebula Only:** Use this to judge if you've pulled enough faint dust out of the background.
* **Mask Map:** The white areas show where the "Core" layer is being used. If the white area is too small, increase Core Stretch; if edges are sharp, increase Feathering.

---

### âž— The HDR Formula (PixelMath)

The script creates a Luminosity Mask from your core stretch and uses it to choose which pixels to display:



By blurring the mask (Feathering), Siril calculates a smooth weighted average between the two images. This ensures the transition is mathematically perfect and invisible to the eye.

---

### ðŸ’¾ Saving & Performance

* **SAVE HDR FITS:** Saves a full 32-bit `HDR_Rescued.fits` to your source folder.
* **Performance Note:** Every slider move processes three temporary FITS files. To avoid lag, ensure your working directory is on an **SSD**. VMware users should use the virtual C: drive for processing.
* **Reset All:** Instantly returns all sliders to neutral positions to start "sculpting" from scratch.

---

ðŸ“– Workflow Strategy: CoreRescue vs. HDR Multiscale
CoreRescue differs from the standard HDR Multiscale script found in Siril. While both aim to balance high-contrast images, they serve different purposes in a processing timeline.

1. The Core Differences
Workflow Timing: CoreRescue is a "Linear Tool." It is used at the very beginning of your processing to perform the initial stretch. HDR Multiscale is a "Post-Stretch Tool" used on images that are already brightened.

The Technology: CoreRescue uses Dual-Path Masking (blending two different stretches). HDR Multiscale uses Wavelet Decomposition, which breaks the image into different sizes of detail (small, medium, and large structures).

Color Preservation: CoreRescue uses asinh math, which is specifically designed to keep colors from turning white in bright areas. HDR Multiscale focuses more on the contrast of structures rather than color fidelity.

2. The "Golden Path" Workflow
To get the best possible result on targets like the Orion Nebula (M42) or the Andromeda Galaxy (M31), use both tools in this specific order:

Step A: CoreRescue (The Foundation)

Load your calibrated Linear FITS.

Use CoreRescue to perform your "Big Stretch."

Ensure the Trapezium stars are protected while the outer nebula is visible.

Save as HDR_Rescued.fits.

Step B: Standard Siril Processing

Open your HDR_Rescued.fits in Siril.

Perform your standard saturation, noise reduction, and green noise removal.

Step C: HDR Multiscale (The Polish)

Run the HDR Multiscale script.

Because CoreRescue already "saved" the highlights, the Multiscale script will now be able to find and sharpen the fine filaments of dust without blowing the core out to white.
